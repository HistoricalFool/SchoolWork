---
title: "Problem Set 1: PSID - Labor Outcomes"
author: Tate Mason
format: pdf
---

# Description of graphs and data

There are some key data facts worth pointing out. First, in the education data, we see that 
units act much how one would expect, with the college educated having higher LFP rates, higher annual
incomes, and higher hourly wages, upon hitting age 40 when many of them have entered long term careers
if pursuing post graduate education. The variance of wages and hours worked is also very erratic, especially
for those with college education. When looking at industry, more interesting patterns arise with a larger gulf
in LFP, hours worked, and income for the white collar segment. Though we do see higher hourly wages for blue 
collar workers, which could perhaps be explained by white collar incomes being comprised of other sources than
wages. The variance of income sees a massive spike for the white collar agents at age 56, but is otherwise in 
lock step with blue collar agents, perhaps due to late career advancement to executive roles or otherwise growing in career
stature. When segmenting by wealth, the wealthy have higher LFP by a wide margin with slightly higher weekly hours
worked as well. Wages are much less static, with rankings shifting frequently until around 45 before a ranking is defined for 
the rest of the time period. Income, of course, is a wide gulf from high to medium and then a smaller gap between medium and low.
This makes sense given we are segmenting on wealth. Again, in this specification, we see massive variances of wage and hours
worked, perhaps due to high wealth individuals earnings fluctuating with age and earlier retirement opportunities.

```{r, output=FALSE}
library(AER)
library(haven)
library(tidyverse)
library(psych)
library(patchwork)
library(broom)
library(Hmisc)
library(knitr)
```

```{r, output=FALSE}
df <- read_dta("~/SchoolWork/Y2S1/Macro/Data/PSID/PSID.dta")
```

```{r, echo=FALSE, output=FALSE}
psid_99_clean <- df %>%
  transmute(
    year = 1999,
    id = ER13019,
    age = ER13010,
    sex = ER13011,
    lfp = ER13601,
    wage = ER13224,
    hr_worked = ER13363,
    cpi_ratio = 0.644,
    educ_HS = ER15937,
    educ_coll = ER15953,
    ind = ER13216,
    wealth = S417,
    weight = ER16518,
    inc = ER13218
  )
psid_01_clean <- df %>%
  transmute(
    year = 2001,
    id = ER17022,
    age = ER17013,
    sex = ER17014,
    lfp = ER17657,
    wage = ER17235,
    hr_worked = ER17393,
    cpi_ratio = 0.685,
    educ_HS = ER19998,
    educ_coll = ER20014,
    ind = ER17227,
    wealth = S517,
    weight = ER20394,
    inc = ER17229
  )
psid_03_clean <- df %>%
  transmute(
    year = 2003,
    id = ER21009,
    age = ER21017,
    sex = ER21018,
    lfp = ER21339,
    wage = ER21159,
    hr_worked = ER21356,
    cpi_ratio = 0.711,
    educ_HS = ER23435,
    educ_coll = ER23451,
    ind = ER21146,
    wealth = S617,
    weight = ER24179,
    inc = ER21153
  )
psid_05_clean <- df %>%
  transmute(
    year = 2005,
    id = ER25009,
    age = ER25017,
    sex = ER25018,
    lfp = ER25328,
    wage = ER25148,
    hr_worked = ER25345,
    cpi_ratio = 0.755,
    educ_HS = ER27402,
    educ_coll = ER27418,
    ind = ER25128,
    wealth = S717,
    weight = ER28078,
    inc = ER25142
  )
psid_07_clean <- df %>%
  transmute(
    year = 2007,
    id = ER36009,
    age = ER36017,
    sex = ER36018,
    lfp = ER36333,
    wage = ER36153,
    hr_worked = ER36350,
    cpi_ratio = 0.802,
    educ_HS = ER40574,
    educ_coll = ER40590,
    ind = ER36133,
    wealth = S817,
    weight = ER41069,
    inc = ER36147
  )
psid_09_clean <- df %>%
  transmute(
    year = 2009,
    id = ER42009,
    age = ER42017,
    sex = ER42018,
    lfp = ER42360,
    wage = ER42188,
    hr_worked = ER42148,
    cpi_ratio = 0.829,
    educ_HS = ER46552,
    educ_coll = ER46568,
    ind = ER42168,
    wealth = ER46970,
    weight = ER47012,
    inc = ER42182
  )
psid_11_clean <- df %>%
  transmute(
    year = 2011,
    id = ER47309,
    age = ER47317,
    sex = ER47318,
    lfp = ER47673,
    wage = ER47501,
    hr_worked = ER47456,
    cpi_ratio = 0.867,
    educ_HS = ER51913,
    educ_coll = ER51929,
    ind = ER47480,
    wealth = ER52394,
    weight = ER52436,
    inc = ER47495
  )
psid_13_clean <- df %>%
  transmute(
    year = 2013,
    id = ER53009,
    age = ER53017,
    sex = ER53018,
    lfp = ER53636,
    wage = ER53201,
    hr_worked = ER53156,
    cpi_ratio = 0.901,
    educ_HS = ER57669,
    educ_coll = ER57685,
    ind = ER53180,
    wealth = ER58211,
    weight = ER58257,
    inc = ER53195
  )
psid_15_clean <- df %>%
  transmute(
    year = 2015,
    id = ER60009,
    age = ER60017,
    sex = ER60018,
    lfp = ER60388,
    wage = ER60216,
    hr_worked = ER60171,
    cpi_ratio = 0.916,
    educ_HS = ER64821,
    educ_coll = ER64837,
    ind = ER60195,
    wealth = ER65408,
    weight = ER65492,
    inc = ER60210
  )
psid_17_clean <- df %>%
  transmute(
    year = 2017,
    id = ER66009,
    age = ER66017,
    sex = ER66018,  
    lfp = ER66666,
    wage = ER66492,
    hr_worked = ER66172,
    cpi_ratio = 0.947,
    educ_HS = ER70755,
    educ_coll = ER70909,
    ind = ER66196,
    wealth = ER71485,
    weight = ER71570,
    inc = ER66211
  )
psid_clean <- bind_rows(
  psid_99_clean,
  psid_01_clean,
  psid_03_clean,
  psid_05_clean,
  psid_07_clean,
  psid_09_clean,
  psid_11_clean,
  psid_13_clean,
  psid_15_clean,
  psid_17_clean
) 


psid_clean <- psid_clean %>%
  group_by(year) %>%
  filter(
    wage <= 997,
    inc <= 9999997,
    hr_worked <= 112
  ) %>%
  mutate(
    educ_group = case_when(
      educ_HS == 3 ~ "HS Dropout",
      educ_HS == 1 & educ_coll == 2 ~ "HS Graduate",
      educ_coll >= 2 & educ_coll <= 7 ~ "College Plus",
      TRUE ~ NA_character_
    ),
    ind_group = case_when(
      ind %in% c(range(17:28), range(47:57), range(67:77), range(107:398)) ~ "Blue Collar",
      ind %in% c(range(407:479), range(507:698), range(707:718), range(727:759), 
        range(769:798), range(807:809), range(828:897), range(907:937)) ~ "White Collar",
      TRUE ~ NA_character_
    ),
    wealth_group = case_when(
      wealth > -99999999 & wealth < 25000 ~ "Low Wealth",
      wealth >= 25000 & wealth < 100000 ~ "Medium Wealth",
      wealth >= 100000 & wealth <= 99999998 ~ "High Wealth",
      TRUE ~ NA_character_
    ),
    wage_real = wage / cpi_ratio,
    inc_real = inc / cpi_ratio,
    log_wage = if_else(wage > 0, log(wage_real), NA_real_),
    log_hr_worked = if_else(hr_worked > 0, log(hr_worked), NA_real_),
    lfp = case_when(
      lfp == 0 ~ 1,
      lfp >= 1 & lfp <= 52 ~ 0,
      TRUE ~ NA_real_
    )
  )

count_block <- function(df, group_name = "Full sample", group_val = "All") {
  df %>%
    summarise(
      group = group_name,
      category = group_val,
      individuals = n_distinct(.data[["id"]]),
      person_years = n(),
      years_pooled = n_distinct(year),
      mean_age = weighted.mean(age, weight, na.rm = TRUE),
      college_pct = 100*weighted.mean(as.numeric(educ_group == "College Plus"), weight, na.rm = TRUE),
      white_collar_pct = 100*weighted.mean(as.numeric(ind_group == "White Collar"), weight, na.rm = TRUE)
    )
}

psid_m <- psid_clean %>%
  filter(
    age >= 25 & age <= 60,
    sex == 1
  )

cuts <- wtd.quantile(psid_m$wealth,
  weights = psid_m$weight,
  probs = c(0.33, 0.67),
  na.rm = TRUE,
  type = "quantile"
)

psid_m <- psid_m %>%
  mutate(
    wealth_tectile = cut(
      wealth,
      breaks = c(-Inf, cuts[1], cuts[2], Inf),
      labels = c("Low Wealth", "Medium Wealth", "High Wealth"),
      right = TRUE
  ))

tab_overall <- count_block(psid_m)

tab_educ <- psid_m %>%
  filter(!is.na(educ_group)) %>%
  group_split(educ_group) %>%
  lapply(function(g) count_block(g, "Education", unique(g$educ_group))) %>%
  bind_rows()

tab_ind <- psid_m %>%
  filter(!is.na(ind_group)) %>%
  group_split(ind_group) %>%
  lapply(function(g) count_block(g, "Industry", unique(g$ind_group))) %>%
  bind_rows()

tab_wealth <- psid_m %>%
  filter(!is.na(wealth_tectile)) %>%
  group_split(wealth_tectile) %>%
  lapply(function(g) count_block(g, "Wealth", unique(g$wealth_tectile))) %>%
  bind_rows()

sum_tab <- bind_rows(tab_overall, tab_educ, tab_ind, tab_wealth) %>%
  mutate(
    across(c(individuals, person_years, years_pooled), as.integer),
    across(ends_with("_pct"), ~ round(.x, 1)),
    avg_age = round(mean_age, 1)
  )
```

# Age profiles

```{r, echo=FALSE, output=FALSE}
wm <- function(x,w) weighted.mean(x, w, na.rm=TRUE)

age_profile_fe <- function(data, y, base_age = 25, w_col = weight) {
  yq <- rlang::enquo(y)
  wq <- rlang::enquo(w_col)

  d <- data %>%
    filter(!is.na(!!yq), !is.na(!!wq)) %>%
    mutate(
      age  = as.integer(age),
      year = as.integer(year)
    )

  if (nrow(d) == 0) return(tibble(age = integer(), y_m = numeric()))

  # build formula: response ~ factor(age) + factor(year)
  resp <- rlang::as_name(yq)
  fml  <- stats::as.formula(paste(resp, "~ factor(age) + factor(year)"))

  # evaluate weights as a numeric vector
  wv <- as.numeric(rlang::eval_tidy(wq, d))

  reg <- stats::lm(fml, data = d, weights = wv)

  af <- broom::tidy(reg) %>%
    dplyr::filter(grepl("^factor\\(age\\)", term)) %>%
    dplyr::mutate(age = as.integer(gsub("factor\\(age\\)", "", term))) %>%
    tidyr::complete(age = base_age:60, fill = list(estimate = 0)) %>%
    dplyr::arrange(age) %>%
    dplyr::transmute(age, y_m = estimate)

  mu <- mean(d[[resp]], na.rm = TRUE)
  dplyr::mutate(af, y_m = y_m + mu)
}

var_prof_year_net <- function(data, y, w_col = weight) {
  yq <- rlang::enquo(y)
  wq <- rlang::enquo(w_col)

  d <- data %>%
    filter(!is.na(!!yq), !!yq > 0, !is.na(!!wq)) %>%
    mutate(
      age  = as.integer(age),
      year = as.integer(year),
      ly   = log(!!yq),
      w    = as.numeric(!!wq)   # <- carry weights as a column
    )

  if (nrow(d) == 0) return(tibble(age = integer(), v = numeric()))

  # Remove year effects with weighted regression
  reg <- stats::lm(ly ~ factor(year), data = d, weights = d$w)
  d$res <- stats::resid(reg)

  # Weighted variance within each age using that age group's weights
  d %>%
    group_by(age) %>%
    summarise(
      v = {
        wg <- w
        rg <- res
        mu <- weighted.mean(rg, wg, na.rm = TRUE)
        sum(wg * (rg - mu)^2, na.rm = TRUE) / sum(wg, na.rm = TRUE)
      },
      .groups = "drop"
    )
}
  
lfp_age_fe <- age_profile_fe(psid_m, lfp)
wage_age_fe <- age_profile_fe(psid_m, wage_real)
hr_age_fe <- age_profile_fe(psid_m, hr_worked)
inc_age_fe <- age_profile_fe(psid_m, inc_real)
var_wage_age <- var_prof_year_net(psid_m, wage_real)
var_hr_age <- var_prof_year_net(psid_m, hr_worked)
```

```{r, echo=FALSE}
ggplot(lfp_age_fe, aes(age, y_m)) +
  geom_line(size = 1.2) +
  labs(
    title = "Labor Force Participation Rate",
    x = "Age",
    y = "LFP Rate"
  ) + 
  theme_minimal()
ggsave("lfp_age_fe.pdf", width = 6, height = 4)

ggplot(wage_age_fe, aes(age, y_m)) +
  geom_line(size = 1.2) +
  labs(
    title = "Real Wage",
    x = "Age",
    y = "Real Wage (2017 $)"
  ) + 
  theme_minimal()
ggsave("wage_age_fe.pdf", width = 6, height = 4)

ggplot(hr_age_fe, aes(age, y_m)) +
  geom_line(size = 1.2) +
  labs(
    title = "Hours Worked per Week",
    x = "Age",
    y = "Hours Worked"
  ) +
  theme_minimal()
ggsave("hr_age_fe.pdf", width = 6, height = 4)

ggplot(inc_age_fe, aes(age, y_m)) +
  geom_line(size = 1.2) +
  labs(
    title = "Real Annual Income",
    x = "Age",
    y = "Real Income (2017 $)"
  ) +
  theme_minimal()
ggsave("inc_age_fe.pdf", width = 6, height = 4)

ggplot(var_wage_age, aes(age, v)) +
  geom_line(size = 1.2) +
  labs(
    title = "Variance of Log Real Wage (Net of Year Effects)",
    x = "Age",
    y = "Variance"
  ) +
  theme_minimal()
ggsave("var_wage_age.pdf", width = 6, height = 4)

ggplot(var_hr_age, aes(age, v)) +
  geom_line(size = 1.2) +
  labs(
    title = "Variance of Log Hours Worked (Net of Year Effects)",
    x = "Age",
    y = "Variance"
  ) +
  theme_minimal()
ggsave("var_hr_age.pdf", width = 6, height = 4)
```

## Education groups
```{r, echo=FALSE}
wage_age_fe_educ <- psid_m %>%
  filter(!is.na(educ_group)) %>%
  group_by(educ_group) %>%
  group_modify(~ age_profile_fe(.x, wage_real)) %>%
  ungroup()

hour_age_fe_educ <- psid_m %>%
  filter(!is.na(educ_group)) %>%
  group_by(educ_group) %>%
  group_modify(~ age_profile_fe(.x, hr_worked)) %>%
  ungroup()

lfp_age_fe_educ <- psid_m %>%
  filter(!is.na(educ_group)) %>%
  group_by(educ_group) %>%
  group_modify(~ age_profile_fe(.x, lfp)) %>%
  ungroup()

inc_age_fe_educ <- psid_m %>%
  filter(!is.na(educ_group)) %>%
  group_by(educ_group) %>%
  group_modify(~ age_profile_fe(.x, inc_real)) %>%
  ungroup()

var_wage_age_educ <- psid_m %>%
  filter(!is.na(educ_group)) %>%
  group_by(educ_group) %>%
  group_modify(~ var_prof_year_net(.x, wage_real)) %>%
  ungroup()

var_hr_age_educ <- psid_m %>%
  filter(!is.na(educ_group)) %>%
  group_by(educ_group) %>%
  group_modify(~ var_prof_year_net(.x, hr_worked)) %>%
  ungroup()
```

```{r, echo=FALSE}
ggplot(lfp_age_fe_educ, aes(age, y_m, color = educ_group)) +
  geom_line(size = 1.2) +
  labs(
    title = "Labor Force Participation Rate by Education",
    x = "Age",
    y = "LFP Rate",
    color = "Education"
  ) +
  theme_minimal()
ggsave("lfp_age_fe_educ.pdf", width = 6, height = 4)

ggplot(inc_age_fe_educ, aes(age, y_m, color = educ_group)) +
  geom_line(size = 1.2) +
  labs(
    title = "Real Annual Income by Education",
    x = "Age",
    y = "Real Income",
    color = "Education"
  ) +
  theme_minimal()
ggsave("inc_age_fe_educ.pdf", width = 6, height = 4)

ggplot(wage_age_fe_educ, aes(age, y_m, color = educ_group)) +
  geom_line(size = 1.2) +
  labs(
    title = "Real Wage by Education",
    x = "Age",
    y = "Real Wage",
    color = "Education"
  ) +
  theme_minimal()
ggsave("wage_age_fe_educ.pdf", width = 6, height = 4)

ggplot(hour_age_fe_educ, aes(age, y_m, color = educ_group)) +
  geom_line(size = 1.2) +
  labs(
    title = "Hours Worked per Week by Education",
    x = "Age",
    y = "Hours Worked",
    color = "Education"
  ) +
  theme_minimal()
ggsave("hr_age_fe_educ.pdf", width = 6, height = 4)

ggplot(var_wage_age_educ, aes(age, v, color = educ_group)) +
  geom_line(size = 1.2) +
  labs(
    title = "Variance of Log Real Wage (Net of Year Effects) by Education",
    x = "Age",
    y = "Variance",
    color = "Education"
  ) +
  theme_minimal()
ggsave("var_wage_age_educ.pdf", width = 6, height = 4)

ggplot(var_hr_age_educ, aes(age, v, color = educ_group)) +
  geom_line(size = 1.2) +
  labs(
    title = "Variance of Log Hours Worked (Net of Year Effects) by Education",
    x = "Age",
    y = "Variance",
    color = "Education"
  ) +
  theme_minimal()
ggsave("var_hr_age_educ.pdf", width = 6, height = 4)
```

## Industry groups
```{r, echo=FALSE}
wage_age_fe_ind <- psid_m %>%
  filter(!is.na(ind_group)) %>%
  group_by(ind_group) %>%
  group_modify(~ age_profile_fe(.x, wage_real)) %>%
  ungroup()

hour_age_fe_ind <- psid_m %>%
  filter(!is.na(ind_group)) %>%
  group_by(ind_group) %>%
  group_modify(~ age_profile_fe(.x, hr_worked)) %>%
  ungroup()

inc_age_fe_ind <- psid_m %>%
  filter(!is.na(ind_group)) %>%
  group_by(ind_group) %>%
  group_modify(~ age_profile_fe(.x, inc_real)) %>%
  ungroup()

lfp_age_fe_ind <- psid_m %>%
  filter(!is.na(ind_group)) %>%
  group_by(ind_group) %>%
  group_modify(~ age_profile_fe(.x, lfp)) %>%
  ungroup()

var_wage_age_ind <- psid_m %>%
  filter(!is.na(ind_group)) %>%
  group_by(ind_group) %>%
  group_modify(~ var_prof_year_net(.x, wage_real)) %>%
  ungroup()

var_hr_age_ind <- psid_m %>%
  filter(!is.na(ind_group)) %>%
  group_by(ind_group) %>%
  group_modify(~ var_prof_year_net(.x, hr_worked)) %>%
  ungroup()

ggplot(lfp_age_fe_ind, aes(age, y_m, color = ind_group)) +
  geom_line(size = 1.2) +
  labs(
    title = "Labor Force Participation Rate by Industry",
    x = "Age",
    y = "LFP Rate",
    color = "Industry"
  ) +
  theme_minimal()
ggsave("lfp_age_fe_ind.pdf", width = 6, height = 4)

ggplot(wage_age_fe_ind, aes(age, y_m, color = ind_group)) +
  geom_line(size = 1.2) +
  labs(
    title = "Real Wage by Industry",
    x = "Age",
    y = "Real Wage",
    color = "Industry"
  ) +
  theme_minimal()
ggsave("wage_age_fe_ind.pdf", width = 6, height = 4)

ggplot(hour_age_fe_ind, aes(age, y_m, color = ind_group)) +
  geom_line(size = 1.2) +
  labs(
    title = "Hours Worked per Week by Industry",
    x = "Age",
    y = "Hours Worked",
    color = "Industry"
  ) +
  theme_minimal()
ggsave("hr_age_fe_ind.pdf", width = 6, height = 4)

ggplot(inc_age_fe_ind, aes(age, y_m, color = ind_group)) +
  geom_line(size = 1.2) +
  labs(
    title = "Real Annual Income by Industry",
    x = "Age",
    y = "Real Income",
    color = "Industry"
  ) +
  theme_minimal()
ggsave("inc_age_fe_ind.pdf", width = 6, height = 4)

ggplot(var_wage_age_ind, aes(age, v, color = ind_group)) +
  geom_line(size = 1.2) +
  labs(
    title = "Variance of Log Real Wage (Net of Year Effects) by Industry",
    x = "Age",
    y = "Variance",
    color = "Industry"
  ) +
  theme_minimal()
ggsave("var_wage_age_ind.pdf", width = 6, height = 4)

ggplot(var_hr_age_ind, aes(age, v, color = ind_group)) +
  geom_line(size = 1.2) +
  labs(
    title = "Variance of Log Hours Worked (Net of Year Effects) by Industry",
    x = "Age",
    y = "Variance",
    color = "Industry"
  ) +
  theme_minimal()
ggsave("var_hr_age_ind.pdf", width = 6, height = 4)
```

## Wealth groups
```{r, echo=FALSE}
wage_age_fe_wealth <- psid_m %>%
  filter(!is.na(wealth_tectile)) %>%
  group_by(wealth_tectile) %>%
  group_modify(~ age_profile_fe(.x, wage_real)) %>%
  ungroup()

hour_age_fe_wealth <- psid_m %>%
  filter(!is.na(wealth_tectile)) %>%
  group_by(wealth_tectile) %>%
  group_modify(~ age_profile_fe(.x, hr_worked)) %>%
  ungroup()

inc_age_fe_wealth <- psid_m %>%
  filter(!is.na(wealth_tectile)) %>%
  group_by(wealth_tectile) %>%
  group_modify(~ age_profile_fe(.x, inc_real)) %>%
  ungroup()

lfp_age_fe_wealth <- psid_m %>%
  filter(!is.na(wealth_tectile)) %>%
  group_by(wealth_tectile) %>%
  group_modify(~ age_profile_fe(.x, lfp)) %>%
  ungroup()

var_wage_age_wealth <- psid_m %>%
  filter(!is.na(wealth_tectile)) %>%
  group_by(wealth_tectile) %>%
  group_modify(~ var_prof_year_net(.x, wage_real)) %>%
  ungroup()

var_hr_age_wealth <- psid_m %>%
  filter(!is.na(wealth_tectile)) %>%
  group_by(wealth_tectile) %>%
  group_modify(~ var_prof_year_net(.x, hr_worked)) %>%
  ungroup()

ggplot(lfp_age_fe_wealth, aes(age, y_m, color = wealth_tectile)) +
  geom_line(size = 1.2) +
  labs(
    title = "Labor Force Participation Rate by Wealth",
    x = "Age",
    y = "LFP Rate",
    color = "Wealth"
  ) +
  theme_minimal()
ggsave("lfp_age_fe_wealth.pdf", width = 6, height = 4)

ggplot(wage_age_fe_wealth, aes(age, y_m, color = wealth_tectile)) +
  geom_line(size = 1.2) +
  labs(
    title = "Real Wage by Wealth",
    x = "Age",
    y = "Real Wage",
    color = "Wealth"
  ) +
  theme_minimal()
ggsave("wage_age_fe_wealth.pdf", width = 6, height = 4)

ggplot(hour_age_fe_wealth, aes(age, y_m, color = wealth_tectile)) +
  geom_line(size = 1.2) +
  labs(
    title = "Hours Worked per Week by Wealth",
    x = "Age",
    y = "Hours Worked",
    color = "Wealth"
  ) +
  theme_minimal()
ggsave("hr_age_fe_wealth.pdf", width = 6, height = 4)

ggplot(inc_age_fe_wealth, aes(age, y_m, color = wealth_tectile)) +
  geom_line(size = 1.2) +
  labs(
    title = "Real Annual Income by Wealth",
    x = "Age",
    y = "Real Income",
    color = "Wealth"
  ) +
  theme_minimal()
ggsave("inc_age_fe_wealth.pdf", width = 6, height = 4)

ggplot(var_wage_age_wealth, aes(age, v, color = wealth_tectile)) +
  geom_line(size = 1.2) +
  labs(
    title = "Variance of Log Real Wage (Net of Year Effects) by Wealth",
    x = "Age",
    y = "Variance",
    color = "Wealth"
  ) +
  theme_minimal()
ggsave("var_wage_age_wealth.pdf", width = 6, height = 4)

ggplot(var_hr_age_wealth, aes(age, v, color = wealth_tectile)) +
  geom_line(size = 1.2) +
  labs(
    title = "Variance of Log Hours Worked (Net of Year Effects) by Wealth",
    x = "Age",
    y = "Variance",
    color = "Wealth"
  ) +
  theme_minimal()
ggsave("var_hr_age_wealth.pdf", width = 6, height = 4)
```

```{=html}
<table border="1" cellspacing="0" cellpadding="4">
  <thead>
    <tr>
      <th>Year</th>
      <th>Group</th>
      <th>Category</th>
      <th>Sample Size</th>
      <th>Observations</th>
      <th>College (%)</th>
      <th>White Collar (%)</th>
    </tr>
  </thead>
  <tbody>
    <!-- 1999 -->
    <tr><td>1999</td><td>All</td><td>All</td><td>1847</td><td>3795</td><td>22.6</td><td>57</td></tr>
    <tr><td></td><td>Education</td><td>HS Dropout</td><td>807</td><td>1288</td><td></td><td></td></tr>
    <tr><td></td><td>Education</td><td>HS Grad</td><td>873</td><td>1288</td><td></td><td></td></tr>
    <tr><td></td><td>Education</td><td>College +</td><td>873</td><td>1288</td><td></td><td></td></tr>
    <tr><td></td><td>Industry</td><td>Blue Collar</td><td>507</td><td>629</td><td></td><td></td></tr>
    <tr><td></td><td>Industry</td><td>White Collar</td><td>507</td><td>629</td><td></td><td></td></tr>
    <tr><td></td><td>Wealth</td><td>Bottom 25%</td><td>1847</td><td>3795</td><td></td><td></td></tr>
    <tr><td></td><td>Wealth</td><td>Middle 50%</td><td>1847</td><td>3795</td><td></td><td></td></tr>
    <tr><td></td><td>Wealth</td><td>Top 25%</td><td>1847</td><td>3795</td><td></td><td></td></tr>

    <!-- 2001 -->
    <tr><td>2001</td><td>All</td><td>All</td><td>1855</td><td>4078</td><td>24.1</td><td>55.7</td></tr>
    <tr><td></td><td>Education</td><td>HS Dropout</td><td>883</td><td>1358</td><td></td><td></td></tr>
    <tr><td></td><td>Education</td><td>HS Grad</td><td>883</td><td>1358</td><td></td><td></td></tr>
    <tr><td></td><td>Education</td><td>College +</td><td>883</td><td>1358</td><td></td><td></td></tr>
    <tr><td></td><td>Industry</td><td>Blue Collar</td><td>541</td><td>646</td><td></td><td></td></tr>
    <tr><td></td><td>Industry</td><td>White Collar</td><td>541</td><td>646</td><td></td><td></td></tr>
    <tr><td></td><td>Wealth</td><td>Bottom 25%</td><td>1855</td><td>4078</td><td></td><td></td></tr>
    <tr><td></td><td>Wealth</td><td>Middle 50%</td><td>1855</td><td>4078</td><td></td><td></td></tr>
    <tr><td></td><td>Wealth</td><td>Top 25%</td><td>1855</td><td>4078</td><td></td><td></td></tr>

    <!-- 2003 -->
    <tr><td>2003</td><td>All</td><td>All</td><td>1844</td><td>4209</td><td>24.1</td><td>28.2</td></tr>
    <tr><td></td><td>Education</td><td>HS Dropout</td><td>892</td><td>1384</td><td></td><td></td></tr>
    <tr><td></td><td>Education</td><td>HS Grad</td><td>892</td><td>1384</td><td></td><td></td></tr>
    <tr><td></td><td>Education</td><td>College +</td><td>892</td><td>1384</td><td></td><td></td></tr>
    <tr><td></td><td>Industry</td><td>Blue Collar</td><td>597</td><td>773</td><td></td><td></td></tr>
    <tr><td></td><td>Industry</td><td>White Collar</td><td>597</td><td>773</td><td></td><td></td></tr>
    <tr><td></td><td>Wealth</td><td>Bottom 25%</td><td>1844</td><td>4209</td><td></td><td></td></tr>
    <tr><td></td><td>Wealth</td><td>Middle 50%</td><td>1844</td><td>4209</td><td></td><td></td></tr>
    <tr><td></td><td>Wealth</td><td>Top 25%</td><td>1844</td><td>4209</td><td></td><td></td></tr>

    <!-- 2005 -->
    <tr><td>2005</td><td>All</td><td>All</td><td>1814</td><td>4231</td><td>22.1</td><td>26.4</td></tr>
    <tr><td></td><td>Education</td><td>HS Dropout</td><td>872</td><td>1380</td><td></td><td></td></tr>
    <tr><td></td><td>Education</td><td>HS Grad</td><td>872</td><td>1380</td><td></td><td></td></tr>
    <tr><td></td><td>Education</td><td>College +</td><td>872</td><td>1380</td><td></td><td></td></tr>
    <tr><td></td><td>Industry</td><td>Blue Collar</td><td>607</td><td>793</td><td></td><td></td></tr>
    <tr><td></td><td>Industry</td><td>White Collar</td><td>607</td><td>793</td><td></td><td></td></tr>
    <tr><td></td><td>Wealth</td><td>Bottom 25%</td><td>1814</td><td>4231</td><td></td><td></td></tr>
    <tr><td></td><td>Wealth</td><td>Middle 50%</td><td>1814</td><td>4231</td><td></td><td></td></tr>
    <tr><td></td><td>Wealth</td><td>Top 25%</td><td>1814</td><td>4231</td><td></td><td></td></tr>

    <!-- 2007 -->
    <tr><td>2007</td><td>All</td><td>All</td><td>1799</td><td>4349</td><td>21.2</td><td>25.0</td></tr>
    <tr><td></td><td>Education</td><td>HS Dropout</td><td>866</td><td>1387</td><td></td><td></td></tr>
    <tr><td></td><td>Education</td><td>HS Grad</td><td>866</td><td>1387</td><td></td><td></td></tr>
    <tr><td></td><td>Education</td><td>College +</td><td>866</td><td>1387</td><td></td><td></td></tr>
    <tr><td></td><td>Industry</td><td>Blue Collar</td><td>642</td><td>839</td><td></td><td></td></tr>
    <tr><td></td><td>Industry</td><td>White Collar</td><td>642</td><td>839</td><td></td><td></td></tr>
    <tr><td></td><td>Wealth</td><td>Bottom 25%</td><td>1799</td><td>4349</td><td></td><td></td></tr>
    <tr><td></td><td>Wealth</td><td>Middle 50%</td><td>1799</td><td>4349</td><td></td><td></td></tr>
    <tr><td></td><td>Wealth</td><td>Top 25%</td><td>1799</td><td>4349</td><td></td><td></td></tr>

    <!-- 2009 -->
    <tr><td>2009</td><td>All</td><td>All</td><td>1767</td><td>4421</td><td>29.3</td><td>26.2</td></tr>
    <tr><td></td><td>Education</td><td>HS Dropout</td><td>929</td><td>1522</td><td></td><td></td></tr>
    <tr><td></td><td>Education</td><td>HS Grad</td><td>929</td><td>1522</td><td></td><td></td></tr>
    <tr><td></td><td>Education</td><td>College +</td><td>929</td><td>1522</td><td></td><td></td></tr>
    <tr><td></td><td>Industry</td><td>Blue Collar</td><td>627</td><td>856</td><td></td><td></td></tr>
    <tr><td></td><td>Industry</td><td>White Collar</td><td>627</td><td>856</td><td></td><td></td></tr>
    <tr><td></td><td>Wealth</td><td>Bottom 25%</td><td>1767</td><td>4421</td><td></td><td></td></tr>
    <tr><td></td><td>Wealth</td><td>Middle 50%</td><td>1767</td><td>4421</td><td></td><td></td></tr>
    <tr><td></td><td>Wealth</td><td>Top 25%</td><td>1767</td><td>4421</td><td></td><td></td></tr>

    <!-- 2011 -->
    <tr><td>2011</td><td>All</td><td>All</td><td>1713</td><td>4441</td><td>28.0</td><td>27.5</td></tr>
    <tr><td></td><td>Education</td><td>HS Dropout</td><td>921</td><td>1536</td><td></td><td></td></tr>
    <tr><td></td><td>Education</td><td>HS Grad</td><td>921</td><td>1536</td><td></td><td></td></tr>
    <tr><td></td><td>Education</td><td>College +</td><td>921</td><td>1536</td><td></td><td></td></tr>
    <tr><td></td><td>Industry</td><td>Blue Collar</td><td>557</td><td>777</td><td></td><td></td></tr>
    <tr><td></td><td>Industry</td><td>White Collar</td><td>557</td><td>777</td><td></td><td></td></tr>
    <tr><td></td><td>Wealth</td><td>Bottom 25%</td><td>1713</td><td>4441</td><td></td><td></td></tr>
    <tr><td></td><td>Wealth</td><td>Middle 50%</td><td>1713</td><td>4441</td><td></td><td></td></tr>
    <tr><td></td><td>Wealth</td><td>Top 25%</td><td>1713</td><td>4441</td><td></td><td></td></tr>

    <!-- 2013 -->
    <tr><td>2013</td><td>All</td><td>All</td><td>1701</td><td>4475</td><td>27.8</td><td>27.6</td></tr>
    <tr><td></td><td>Education</td><td>HS Dropout</td><td>928</td><td>1555</td><td></td><td></td></tr>
    <tr><td></td><td>Education</td><td>HS Grad</td><td>928</td><td>1555</td><td></td><td></td></tr>
    <tr><td></td><td>Education</td><td>College +</td><td>928</td><td>1555</td><td></td><td></td></tr>
    <tr><td></td><td>Industry</td><td>Blue Collar</td><td>566</td><td>782</td><td></td><td></td></tr>
    <tr><td></td><td>Industry</td><td>White Collar</td><td>566</td><td>782</td><td></td><td></td></tr>
    <tr><td></td><td>Wealth</td><td>Bottom 25%</td><td>1701</td><td>4475</td><td></td><td></td></tr>
    <tr><td></td><td>Wealth</td><td>Middle 50%</td><td>1701</td><td>4475</td><td></td><td></td></tr>
    <tr><td></td><td>Wealth</td><td>Top 25%</td><td>1701</td><td>4475</td><td></td><td></td></tr>

    <!-- 2015 -->
    <tr><td>2015</td><td>All</td><td>All</td><td>1650</td><td>4365</td><td>27.3</td><td>28.1</td></tr>
    <tr><td></td><td>Education</td><td>HS Dropout</td><td>921</td><td>1512</td><td></td><td></td></tr>
    <tr><td></td><td>Education</td><td>HS Grad</td><td>921</td><td>1512</td><td></td><td></td></tr>
    <tr><td></td><td>Education</td><td>College +</td><td>921</td><td>1512</td><td></td><td></td></tr>
    <tr><td></td><td>Industry</td><td>Blue Collar</td><td>566</td><td>782</td><td></td><td></td></tr>
    <tr><td></td><td>Industry</td><td>White Collar</td><td>566</td><td>782</td><td></td><td></td></tr>
    <tr><td></td><td>Wealth</td><td>Bottom 25%</td><td>1650</td><td>4365</td><td></td><td></td></tr>
    <tr><td></td><td>Wealth</td><td>Middle 50%</td><td>1650</td><td>4365</td><td></td><td></td></tr>
    <tr><td></td><td>Wealth</td><td>Top 25%</td><td>1650</td><td>4365</td><td></td><td></td></tr>

    <!-- 2017 -->
    <tr><td>2017</td><td>All</td><td>All</td><td>1908</td><td>4684</td><td>49.3</td><td>NA</td></tr>
    <tr><td></td><td>Education</td><td>HS Dropout</td><td>880</td><td>1399</td><td></td><td></td></tr>
    <tr><td></td><td>Education</td><td>HS Grad</td><td>880</td><td>1399</td><td></td><td></td></tr>
    <tr><td></td><td>Education</td><td>College +</td><td>880</td><td>1399</td><td></td><td></td></tr>
    <tr><td></td><td>Industry</td><td>Blue Collar</td><td>551</td><td>764</td><td></td><td></td></tr>
    <tr><td></td><td>Industry</td><td>White Collar</td><td>551</td><td>764</td><td></td><td></td></tr>
    <tr><td></td><td>Wealth</td><td>Bottom 25%</td><td>1908</td><td>4684</td><td></td><td></td></tr>
    <tr><td></td><td>Wealth</td><td>Middle 50%</td><td>1908</td><td>4684</td><td></td><td></td></tr>
    <tr><td></td><td>Wealth</td><td>Top 25%</td><td>1908</td><td>4684</td><td></td><td></td></tr>
  </tbody>
</table>
```


