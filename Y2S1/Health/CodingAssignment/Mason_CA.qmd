---
title: "Reduced Form Coding Assignment - ECON 8250"
author: "Tate Mason"
format: pdf
---

1. Start by coming up with a research question where you might use this research design.
This does not need to be too creative, I just want an example. However, I would prefer
if it wasn’t the one I used in class and was vaguely related to health. Intuitively and
in words, describe what the endogeneity concern might be with a question like this.
2. Tell me basics about the dataset you simulate. What is your unit of observation? Then,
in words, describe what variables you are assuming constitute the “true model” and
which variables you are assuming you can observe and cannot observe. Describe any
important correlations between variables. Also, describe other variables, like policies
(for diff-in-diff), thresholds (for RD), or instruments (for IV). Give me an equation for
your “true model” and introduce all the letters you are using. I want an equation, written like they would be written in a paper, not STATA code. Then separately, tell
me what your “true” coefficients are (i.e. β = 2).
3. In words and equations, describe the regressions you are running. Both the regressions
that have an endogeneity problem and the ones which you “fix.”
4. Produce a table of summary statistics with the mean, standard deviation, number
of observations, min and max of each variable you use. This is both regressors and
outcome variables. You do not need to show me summary statistics for fixed effects.
5. Produce regression results in nice table layout, with intuitive variable labels (i.e. not
stata variable names), and not too many variables (i.e. don’t display fixed effects).
Describe the regression results for each of your regressions in words.

# Fixed Effects Model

## 1. Research Question

How does insurance premium rise with age and risk preference?

## 2. 

```{r, output=FALSE}
set.seed(0219)
n <- 1000
id <- 1:n
age <- sample(18:70, n, replace = TRUE)
risk_pref <- rnorm(n, mean = 0, sd = 1)
insprem <- 200 + 5 * age + 20 * risk_pref 
+ rnorm(n, mean = 0, sd = 10)
data <- data.frame(id, age, risk_pref, insprem)
```

Each agent is a unit, with n=1000. The true model is: 
$$InsPrem_i = \beta_0 + \beta_1\cdot Age_i + \beta_2\cdot RiskPref_i + \epsilon_i,$$
where $InsPrem_i$ is the insurance premium for agent i, $Age_i$ is the age of agent i, $RiskPref_i$ is the risk preference of agent i,
and $\epsilon_i$ is the error term. The true coefficients are: $\beta_0 = 200$, $\beta_1 = 5$, $\beta_2 = 20$, $\beta_3 = 10$.

## 3. Regressions

The regression with endogeneity problem is: 
$$InsPrem_i = \alpha_0 + \alpha_1\cdot Age_i + u_i,$$
where $u_i$ is the error term which includes the risk preference parameter. The regression that "fixes" the endogeneity problem is: 
$$InsPrem_i = \gamma_0 + \gamma_1\cdot Age_i + \gamma_2\cdot RiskPref_i +  v_i,$$
where $v_i$ is the error term. 

## 4. Summary statistics
```{r}
library(psych)
describe(data)
```

## 5. Regression results
```{r}
library(lmtest)
library(sandwich)
model1 <- lm(insprem ~ age, data = data)
model2 <- lm(insprem ~ age + risk_pref, data = data)
summary(model1)
summary(model2)
``` 

# IV Model

## 1. Research Question

How does exercise frequency affect mental health, using weather as an instrument?

## 2. Dataset

```{r, output=FALSE}
set.seed(0219)
n <- 1000
id <- 1:n
exercise_freq <- rnorm(n, mean = 3, sd = 1)
weather <- rnorm(n, mean = 0, sd = 1)
mental_health <- 50 + 2 * exercise_freq + 5 * weather + rnorm(n, mean = 0, sd = 5)
data_iv <- data.frame(id, exercise_freq, weather, mental_health)
```

Each agent is a unit, with n=1000. The true model is:

$$MentalHealth_i = \beta_0 + \beta_1\cdot ExerciseFreq_i + \beta_2\cdot Weather_i + \epsilon_i,$$

where $MentalHealth_i$ is the mental health score for agent i, $ExerciseFreq_i$ is the exercise 
frequency of agent i, $Weather_i$ is the weather condition for agent i, and $\epsilon_i$ is the error term.
The true coefficients are: $\beta_0 = 50$, $\beta_1 = 2$, $\beta_2 = 5$.

## 3. Regressions
The regression with endogeneity problem is:
$$MentalHealth_i = \alpha_0 + \alpha_1\cdot ExerciseFreq_i + u_i,$$

where $u_i$ is the error term which includes the weather parameter. The regression that "fixes" the endogeneity problem using IV is:
First stage:

$$ExerciseFreq_i = \pi_0 + \pi_1\cdot Weather_i + w_i,$$

Second stage:

$$MentalHealth_i = \gamma_0 + \gamma_1\cdot \hat{ExerciseFreq}_i + v_i,$$

where $\hat{ExerciseFreq}_i$ is the predicted exercise frequency from the first stage, and $v_i$ is the error term.

## 4. Summary statistics
```{r}
describe(data_iv)
```

## 5. Regression results
```{r}
library(AER)
model1_iv <- lm(mental_health ~ exercise_freq, data = data_iv)
model2_iv <- ivreg(mental_health ~ exercise_freq | weather, data = data_iv)
summary(model1_iv)
summary(model2_iv)
```

As can be seen from the regression results, the first model without the instrument shows a biased estimate of the effect of exercise 
frequency on mental health due to omitted variable bias. The second model using weather as an instrument provides a more accurate 
estimate of the causal effect of exercise frequency on mental health.
